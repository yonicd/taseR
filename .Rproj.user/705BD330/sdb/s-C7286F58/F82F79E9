{
    "contents" : "setwd(\"C:\\\\Users\\\\yoni\\\\Documents\\\\GitHub\\\\tase\")\n\nstockIDs=read.csv(\"stockIDs.csv\")\ntickers=read.csv(\"tickers.csv\")\n\n\n\nstockID=left_join(tickers,stockIDs,by=\"shareID\")%>%rename(Name.Full=name)\n\n\nlibrary(lubridate)\nlibrary(XML)\nlibrary(plyr)\nlibrary(dplyr)\nlibrary(RSelenium)\n\nsource(\"call_tase.r\");source(\"call_tase_index.r\");source(\"call_tase_index_intraday.r\");source(\"call_tase_index_components.r\")\n\nurl='http://www.tase.co.il/Eng/Management/GeneralPages/Pages/GridOnSeparatePage.aspx?Action=2&subDataType=2&IndexId=137&day=3&date=634138848000000000&GridId=143&CurGuid={F9AF0818-85CC-43D3-AE34-76D89C0EB977}'\n\nhist.node=getNodeSet(htmlParse(url),(\"//table[contains(@id,\n                                     'ctl00_SPWebPartManager1_g_fb4ab7c6_284a_4f5c_9cc2_0ebb4a9012a3_ctl00_NiaROGrid1_DataGrid1')]\"))\n\ntase=tase.fetch(cID='000281',\n                sID='00281014',\n                From.Date = format(Sys.Date()-months(3),\"%d/%m/%Y\"))\n\ntase.index=tase.fetch(indexID='142',\n                From.Date = format(Sys.Date()-months(3),\"%d/%m/%Y\"))\n\ntase.index.intraday=tase.fetch(indexID='142',\n                      From.Date = format(Sys.Date()-months(3),\"%d/%m/%Y\"),intraday=T)\n\ntase.index.component=tase.fetch(indexID='142',\n                               From.Date = format(Sys.Date()-months(3),\"%d/%m/%Y\"),intraday=T)\n\ntase.fetch=function(cID='',sID='',indexID='',From.Date=format(Sys.Date()-months(1),\"%d/%m/%Y\"),To.Date=format(Sys.Date(),\"%d/%m/%Y\"),Dtype='0',Freq=\"daily\",intraday=F){\n  if(cID!=''&sID!='')  tase.security(companyID=cID,shareID=sID,From.Date,To.Date,subDataType=Dtype,Freq)\n  \n  if(indexID!=''&intraday==F)  tase.index(indexID,From.Date,To.Date,Freq)\n  \n  if(indexID!=''&intraday==T)  tase.index.intraday(indexID,From.Date,To.Date)\n  \n  if(indexID!=''&intraday==T)  tase.index.component(indexID,From.Date)\n  \n  #system(\"phantomjs.exe get_tase_popup.js\")\n  \n  pJS <- phantom()\n  remDr <- remoteDriver(browserName = \"phantom\")\n  remDr$open()\n  Jin=paste0(readLines(\"get_tase.js\"),collapse = \"\\n\")\n  result <- remDr$phantomExecute(Jin)\n  Sys.sleep(8)\n  pJS$stop()\n  \n  url=\"tase_out.html\"\n  dataNode =getNodeSet(htmlParse(url),(\"//table[contains(@id,'gridHistoryData_DataGrid1')]\"))\n  dataNode =getNodeSet(htmlParse(url),(\"//table[contains(@id,'DataGrid1')]\"))\n  dataNode =getNodeSet(htmlParse(url),(\"//table[contains(@id,'tabAllShares')]\n                                        //td//a//@onclick\"))\n  metaNode =getNodeSet(htmlParse(url),(\"//table[contains(@id,'securityGrid_DataGrid1')]\"))\n  \n  \n  y=getNodeSet(htmlParse(paste0(\"www.tase.co.il\",str_split(dataNode[[4]][1],\"'\",n=3)[[1]][2]),isURL = T),\"//table\")\n  \n  x=unlist(sapply(xpathSApply(dataNode[[1]],\"//td[@onclick]\",xmlAttrs),'[[',1))\n  x=x[grepl(\"csv\",x)]\n  \n  tase=mdply(x,.fun = function(xin){\n    suppressWarnings(\n             read.csv(xin,\n             header = T,\n             skip = 1,\n             col.names = c(\"Time\",\"LastIndex\",\"IndexType\",\"Change\"),\n             stringsAsFactors = F))})\n  \n  if(length(metaNode)==0){\n    tase=readHTMLTable(dataNode[[1]],header = T)%>%\n          mutate_each(funs(as.Date(.,\"%d/%m/%Y\")),contains(\"date\"))%>%\n          mutate_each(funs(as.numeric(gsub(\"[,|%]\",\"\",.))),-contains(\"date\"))\n    \n    tase=readHTMLTable(dataNode[[1]],header = T)\n    tase=tase[,-c(9,10)]%>%filter(!is.na(ISIN))\n\n    \n    \n  }else{\n    tase=left_join(\n                  readHTMLTable(metaNode[[1]],header = T)[1,c(1:4)]%>%mutate(x=1),\n                  readHTMLTable(dataNode[[1]],header = T)%>%\n                    mutate_each(funs(as.Date(.,\"%d/%m/%Y\")),contains(\"date\"))%>%\n                    mutate_each(funs(as.numeric(gsub(\"[,|%]\",\"\",.))),-contains(\"date\"),-ends_with(\"type\"))%>%mutate(x=1),\n                  by=\"x\")%>%\n      select(-x)\n}\nreturn(tase)\n}",
    "created" : 1430067319898.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1884258174",
    "id" : "F82F79E9",
    "lastKnownWriteTime" : 1429979855,
    "path" : "~/GitHub/tase/tase.r",
    "project_path" : "tase.r",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}